<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Activities</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="App">
        <header>
            <h1 v-text="sitename"></h1>
            <button v-on:click='showCheckout' :disabled="isCartEmpty">
                <span><i class="fa-solid fa-cart-shopping"></i></span>
                {{cartItemCount}}
            </button>
        </header>
        <main>
            <div v-if="showProduct">
                <button class="sort-button" @click="showSortModal = true">
                    <i class="fa-solid fa-arrow-up-wide-short"></i> Sort
                </button> 
                <div class="search-bar">
                    <input type="text" v-model="searchQuery" placeholder="Search lessons..." v-on:input="performSearch">
                </div>
                <div class="product-list">
                    <div v-for="product in sortedProducts" :key="product.id" class="product-card">
                        <figure>
                            <img v-bind:src="'https://cst3144-server-fi5v.onrender.com/images/' + product.image" :alt="product.title">
                        </figure>
                        <h2>{{product.title}}</h2>
                        <p v-html="product.description"></p>
                        <p><strong>Location:</strong> {{product.location}}</p>
                        <p><strong>Price:</strong> AED {{product.price}}</p>
                        <p><strong>Available Slots:</strong> {{product.availableInventory}}</p>
                        <button 
                            @click="addToCart(product)" 
                            v-if="canAddToCart(product)">
                            Add to Cart
                        </button>
                        <button disabled v-else>Add to Cart</button>
                    </div>
                </div>
            </div>
            <div v-if="showSortModal" class="modal-overlay" @click.self="showSortModal = false">
            <div class="modal-content">
                    <h3>Sort Activities</h3>
                    <div class="sort-group">
                        <h4>Sort By:</h4>
                        <label>
                            <input type="radio" v-model="sortCriteria" value="title"> Subject
                        </label>
                        <label>
                            <input type="radio" v-model="sortCriteria" value="price"> Price
                        </label>
                        <label>
                            <input type="radio" v-model="sortCriteria" value="location"> Location
                        </label>
                        <label>
                            <input type="radio" v-model="sortCriteria" value="availableInventory"> Available Slots
                        </label>
                        </div>
                        <div class="sort-group">
                        <h4>Order:</h4>
                        <label>
                            <input type="radio" v-model="sortOrder" value="ascending"> Ascending
                        </label>
                        <label>
                            <input type="radio" v-model="sortOrder" value="descending"> Descending
                        </label>
                    </div>
                    <button @click="showSortModal = false" class="close-modal-button">
                        Close
                    </button>
                </div>
            </div>
            <div v-else>
                <h2>Checkout</h2>
                <h3>Your Cart ({{cartItemCount}} Items)</h3>
                <div v-if="cartProducts.length > 0" class="cart-items-container">
                    
                    <div v-for="item in cartProducts" :key="'cart-' + item.id" class="cart-product-card">
                        <figure class="cart-product-figure">
                            <img v-bind:src="item.image" :alt="item.title">
                        </figure>
                        <div class="cart-product-details">
                            <h4>{{item.title}}</h4>
                            <p><strong>Price:</strong> AED {{item.price}}</p>
                            <p><strong>Quantity:</strong> {{item.quantity}}</p>
                            <p class="cart-total-price">Total: AED {{item.quantity*item.price}}</p>
                            <button @click="removeItem(item)">
                                Remove one
                            </button>
                        </div>
                    </div>
                    <hr>
                    <p>
                        <strong>Cart Subtotal: </strong> 
                        <span style="font-size: 1.2em; color: green;">AED {{cartTotal}}</span>
                    </p> 
                    <button v-if="!checkoutConfirmed" @click="proceedToContact">Proceed to Contact Information</button>   
                </div>
                <div v-else>
                    <p>Your cart is empty.</p>
                </div>
                <hr>
                <div v-if="checkoutConfirmed">
                    <h3>Contact Information</h3>
                    <p>
                        <strong>First Name: </strong>
                        <input v-model.trim="order.firstName" />
                    </p>
                    <p>
                        <strong>Last Name: </strong>
                        <input v-model.trim="order.lastName" />
                    </p>
                    <p>
                        <strong>Phone: </strong> <input v-model="order.phone" />
                    </p>
                    <p>
                        <strong>Email: </strong> <input v-model="order.email" />
                    </p>
                    <h2>Booking Confirmation</h2>
                    <p>First Name: {{order.firstName}}</p>
                    <p>Last Name: {{order.lastName}}</p>
                    <p>Phone: {{order.phone}}</p>
                    <p>Email: {{order.email}}</p>                 
                    <button v-on:click="submitForm" :disabled="!isValidOrder">Book</button>
                </div>
            </div>
        </main>
    </div>
    <script src="script.js">
    </script>
</body>
</html>